# Zenodo Release System - Implementation Summary

## What Was Implemented

A complete automated release system for publishing Arca Verborum datasets to Zenodo, consisting of:

### 1. Documentation Templates (`templates/`)

**DATASET_DESCRIPTION.md.j2**
- Complete scientific description of the dataset
- Motivation section emphasizing educational experience with students
- References GLED (Tresoldi 2023, DOI: 10.5334/johd.96)
- Methodology and data quality sections
- Auto-populated with statistics from validation reports

**RELEASE_NOTES.md.j2**
- Version-specific release information
- Dataset statistics and quality metrics
- SHA256 checksums for all files
- Archive contents listing
- Version distribution tables

### 2. Release Preparation Script (`prepare_release.py`)

Automates the entire release preparation process:
- Prompts for version (defaults to today's date: YYYYMMDD)
- Generates documentation from templates with real statistics
- Creates ZIP archive with subdirectory structure:
  - All output CSV files
  - sources.bib
  - validation_report.json
  - Generated DATASET_DESCRIPTION.md
  - Generated RELEASE_NOTES.md
- Computes SHA256 checksums
- Updates zenodo.metadata.yml
- Tracks releases in .zenodo_state.json
- Optional git tag creation with `--git-tag`

### 3. Zenodo Metadata (`zenodo.metadata.yml`)

Complete metadata configuration:
- **Title:** "Arca Verborum: A Global Lexical Database for Computational Historical Linguistics"
- **Author:** Tiago Tresoldi (ORCID: 0000-0002-2863-1467)
- **Affiliation:** Department of Linguistics and Philology, Uppsala University
- **License:** CC-BY-4.0
- **Keywords:** linguistics, computational linguistics, historical linguistics, etc.
- **Communities:** linguistics
- **Description:** Emphasizes accessibility for students and rapid method development

### 4. Zenodo Publishing Script (`zenodo_publish.py`)

Fixed JSON serialization bug in --show mode for preview functionality.

### 5. Supporting Files

- **RELEASE_WORKFLOW.md** - Complete step-by-step release instructions
- **Updated .gitignore** - Excludes releases/ directory
- **Updated requirements.txt** - Added jinja2, pyyaml, requests

## Test Results

Successfully created test release:
- **Version:** 20251001
- **Archive:** arcaverborum_20251001.zip (85 MB compressed, 568 MB uncompressed)
- **Contents:** 9 files including all CSVs and generated documentation
- **Statistics extracted:**
  - 2,915,377 lexical forms
  - 9,738 languages
  - 168,263 parameters
  - 81 datasets with cognates
  - 95.15% Glottolog coverage
  - 84.72% Concepticon coverage
  - 27.84% forms with cognate data
  - 77.66% forms with segmentation

## File Structure

```
arcaverborum/
├── .gitignore                    # ✓ Updated
├── .zenodo_state.json           # ✓ Created (tracks releases)
├── zenodo.metadata.yml          # ✓ Created (Zenodo config)
├── requirements.txt             # ✓ Updated
├── prepare_release.py           # ✓ Created (release automation)
├── zenodo_publish.py            # ✓ Fixed
├── RELEASE_WORKFLOW.md          # ✓ Created (documentation)
├── IMPLEMENTATION_SUMMARY.md    # ✓ This file
├── templates/                   # ✓ Created
│   ├── DATASET_DESCRIPTION.md.j2
│   └── RELEASE_NOTES.md.j2
├── releases/                    # ✓ Created (ignored by git)
│   └── arcaverborum_20251001.zip
└── output/                      # Existing (generated by merger)
    ├── forms.csv
    ├── languages.csv
    ├── parameters.csv
    ├── metadata.csv
    ├── references.csv
    ├── sources.bib
    └── validation_report.json
```

## Complete Workflow

### For Your First Release:

```bash
# 1. Run the merger (if not already done)
python merge_cldf_datasets.py

# 2. Prepare the release
python prepare_release.py
# Enter version or press Enter for today's date

# 3. Review the archive
unzip -l releases/arcaverborum_20251001.zip
unzip -p releases/arcaverborum_20251001.zip arcaverborum_20251001/DATASET_DESCRIPTION.md | less

# 4. Preview Zenodo metadata
ZENODO_TOKEN=dummy python zenodo_publish.py --show

# 5. Test on sandbox
export ZENODO_SANDBOX_TOKEN="your-sandbox-token"
python zenodo_publish.py --sandbox

# 6. Publish for real
export ZENODO_TOKEN="your-production-token"
python zenodo_publish.py

# 7. Create git tag and push
python prepare_release.py --version 20251001 --git-tag
git add .zenodo_state.json zenodo.metadata.yml
git commit -m "Release version 20251001"
git push origin master v20251001
```

### For Subsequent Releases:

After first release, Zenodo will have created a concept DOI. The script automatically detects this and creates new versions under the same concept:

```bash
python merge_cldf_datasets.py  # Update data
python prepare_release.py      # Creates new version
python zenodo_publish.py       # Automatically creates new version, not new concept
```

## Key Features

1. **Fully Automated:** One command creates complete release archive with documentation
2. **Quality Assurance:** All statistics auto-extracted from validation_report.json
3. **Version Control:** State tracking prevents accidental re-releases
4. **Testing Support:** Sandbox mode for safe testing
5. **Git Integration:** Optional automated tagging
6. **Scientific Focus:** Documentation emphasizes pedagogical value and references GLED
7. **Reproducible:** All checksums computed and documented

## What You Need to Do Before First Release

1. **Get Zenodo API Tokens:**
   - Sandbox: https://sandbox.zenodo.org/account/settings/applications/tokens/new/
   - Production: https://zenodo.org/account/settings/applications/tokens/new/

2. **Test on Sandbox:**
   ```bash
   export ZENODO_SANDBOX_TOKEN="your-token"
   python zenodo_publish.py --sandbox
   ```

3. **Verify Everything:**
   - Check sandbox.zenodo.org for your test deposit
   - Review metadata, file, documentation
   - Make any adjustments to templates if needed

4. **Publish to Production:**
   ```bash
   export ZENODO_TOKEN="your-token"
   python zenodo_publish.py
   ```

5. **Save the Concept DOI:**
   - Zenodo returns a concept DOI (e.g., 10.5281/zenodo.XXXXXXX)
   - This is automatically saved in .zenodo_state.json
   - All future releases will be versions under this same concept DOI

## Documentation Highlights

The generated DATASET_DESCRIPTION.md includes:

- **Your motivation:** Based on teaching experience, student accessibility challenges
- **GLED reference:** Cites your previous work (Tresoldi 2023, DOI: 10.5334/johd.96)
- **Positioning:** Complements CLDF, doesn't replace it
- **Educational focus:** Emphasizes rapid method development and student projects
- **Complete metadata:** All statistics, version info, quality metrics
- **Proper citations:** Both for Arca Verborum and original Lexibank project

## Notes

- Archive size is reasonable at ~85 MB (compressed from 542 MB)
- Documentation is generated fresh for each release with current statistics
- Version scheme is flexible (YYYYMMDD with optional .N suffix)
- All checksums are SHA256 for verification
- System is designed for long-term maintenance and updates

## Support

See RELEASE_WORKFLOW.md for detailed instructions and troubleshooting.
